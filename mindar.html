<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Telusuri Cimande AR</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />

  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      background: transparent;
      overflow: hidden;
    }
    a-scene {
      position: fixed; inset: 0; width: 100%; height: 100%;
      z-index: 0;
    }
    .back-button {
      position: absolute;
      top: 18px;
      left: 16px;
      z-index: 20;
      background: transparent;
      color: white;
      border: 0;
      padding: 8px 12px;
      text-decoration: none;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto;
    }
    .slide-dots {
      position: absolute;
      bottom: 28px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 20;
      display: flex;
      gap: 10px;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    .dot {
      width: 12px; height: 12px;
      border-radius: 50%;
      background: #888;
      opacity: 0.6;
      transform-origin: center;
      transition: all 0.25s ease;
    }
    .dot.active {
      background: limegreen;
      transform: scale(1.3);
      opacity: 1;
    }
  </style>
</head>


<body>
  <a href="index.html" class="back-button">‚Üê</a>

  <div class="slide-dots" id="slideDots">
    <div class="dot active"></div>
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
  </div>

  <a-scene
    mindar-image="imageTargetSrc: ./assets/marker.mind; autoStart: true;
                  filterMinCF: 0.001;
                  filterBeta: 0.05;"
    embedded
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: true"
    renderer="antialias: true; alpha: true; physicallyCorrectLights: true;"
  >
    <a-entity light="type: ambient; intensity: 1.0"></a-entity>
    <a-entity light="type: directional; intensity: 1.0; position: 1 2 1"></a-entity>

    <a-assets>
      <img id="i11" src="./assets/img-pencak1.jpg">
      <img id="i12" src="./assets/img-pencak2.jpg">
      <img id="i13" src="./assets/img-pencak3.jpg">
      <img id="i14" src="./assets/img-pencak4.jpg">
      <img id="i21" src="./assets/img-salak1.jpg">
      <img id="i22" src="./assets/img-salak2.jpg">
      <img id="i23" src="./assets/img-salak3.jpg">
      <img id="i24" src="./assets/img-salak4.jpg">
      <img id="i31" src="./assets/img-lidah1.jpg">
      <img id="i32" src="./assets/img-lidah2.jpg">
      <img id="i33" src="./assets/img-lidah3.jpg">
      <img id="i34" src="./assets/img-lidah4.jpg">
      <img id="i41" src="./assets/img-alam1.jpg">
      <img id="i42" src="./assets/img-alam2.jpg">
      <img id="i43" src="./assets/img-alam3.jpg">
      <img id="i44" src="./assets/img-alam4.jpg">
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false" fov="150"></a-camera>

    <a-entity id="marker" mindar-image-target="targetIndex: 0; autoHide: false;">
      <a-entity id="carousel" position="0 0 0" scale="1 1 1">
        <!-- MAIN SLIDE 1 -->
        <a-entity class="main-slide" position="0 0 0">
          <a-entity class="substack" position="0 0 0">
            <a-entity class="sub" position="0 0.6 0">
              <a-plane src="#i11" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Pencak Silat Cimande" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 0 0">
              <a-plane src="#i12" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Pencak Silat Cimande" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -0.6 0">
              <a-plane src="#i13" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Pencak Silat Cimande" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -1.2 0">
              <a-plane src="#i14" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Pencak Silat Cimande" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
          </a-entity>
        </a-entity>

        <!-- MAIN SLIDE 2 -->
        <a-entity class="main-slide" position="1.3 0 0">
          <a-entity class="substack" position="0 0 0">
            <a-entity class="sub" position="0 0.6 0">
              <a-plane src="#i21" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Agro Wisata Salak Slebor" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 0 0">
              <a-plane src="#i22" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Agro Wisata Salak Slebor" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -0.6 0">
              <a-plane src="#i23" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Agro Wisata Salak Slebor" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -1.2 0">
              <a-plane src="#i24" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Agro Wisata Salak Slebor" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
          </a-entity>
        </a-entity>

        <!-- MAIN SLIDE 3 -->
        <a-entity class="main-slide" position="2.6 0 0">
          <a-entity class="substack" position="0 0 0">
            <a-entity class="sub" position="0 0.6 0">
              <a-plane src="#i31" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Agro Wisata Lidah Buaya" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 0 0">
              <a-plane src="#i32" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Agro Wisata Lidah Buaya" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -0.6 0">
              <a-plane src="#i33" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Agro Wisata Lidah Buaya" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -1.2 0">
              <a-plane src="#i34" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Agro Wisata Lidah Buaya" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
          </a-entity>
        </a-entity>

        <!-- MAIN SLIDE 4 -->
        <a-entity class="main-slide" position="3.9 0 0">
          <a-entity class="substack" position="0 0 0">
            <a-entity class="sub" position="0 0.6 0">
              <a-plane src="#i41" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Wisata Alam & Trekking" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 0 0">
              <a-plane src="#i42" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Wisata Alam & Trekking" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -0.6 0">
              <a-plane src="#i43" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Wisata Alam & Trekking" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -1.2 0">
              <a-plane src="#i44" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Wisata Alam & Trekking" align="center" width="0.9" position="0 -0.3 0.05" color="#fff"></a-text>
            </a-entity>
          </a-entity>
        </a-entity>
      </a-entity>
    </a-entity>
  </a-scene>


  <script>
    const marker = document.querySelector('#marker');
    const carousel = document.querySelector('#carousel');
    const mainSlides = Array.from(document.querySelectorAll('.main-slide'));
    const dots = Array.from(document.querySelectorAll('.dot'));
    const dotsContainer = document.querySelector('#slideDots');
    let mainIndex = 0;
    const subIndex = [1,1,1,1];
    const animDur = 280;
    const mainSpacing = 1.2;
    const subSpacing = 0.7;
    let markerVisible = false;

    // Animation helper
    function animateOnce(el, name, data) {
      el.removeAttribute(name);
      void el.offsetWidth;
      el.setAttribute(name, data);
    }

    function updateMainCarousel(newIdx){
      mainSlides.forEach((ms, i)=>{
        const x = (i - newIdx) * mainSpacing;
        animateOnce(ms, 'animation__pos', {
          property:'position', to:`${x} 0 0`, dur:animDur, easing:'easeOutCubic'
        });
      });
      dots.forEach((d,i)=>d.classList.toggle('active', i===newIdx));
    }

    function updateSubstack(mainIdx){
      const subs = mainSlides[mainIdx].querySelectorAll('.sub');
      const active = subIndex[mainIdx];
      subs.forEach((sub,i)=>{
        const y = (i - active) * subSpacing;
        animateOnce(sub, 'animation__sub', {
          property:'position', to:`0 ${-y} 0`, dur:animDur, easing:'easeOutCubic'
        });
        const scale = (i===active)?'0.95 0.95 0.95':'0.7 0.7 0.7';
        animateOnce(sub, 'animation__scale', {
          property:'scale', to:scale, dur:animDur, easing:'easeOutCubic'
        });
      });
    }

    mainSlides.forEach((_,i)=>updateSubstack(i));
    updateMainCarousel(mainIndex);

    // Swipe only when marker visible
    let startX=0, startY=0;
    document.body.addEventListener('touchstart', e=>{
      if(!markerVisible) return;
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    }, {passive:true});
    document.body.addEventListener('touchend', e=>{
      if(!markerVisible) return;
      const endX=e.changedTouches[0].clientX;
      const endY=e.changedTouches[0].clientY;
      const dx=endX-startX, dy=endY-startY;
      const TH=40;
      if(Math.abs(dx)>Math.abs(dy)){
        if(dx<-TH){ mainIndex=(mainIndex+1)%mainSlides.length; updateMainCarousel(mainIndex); }
        else if(dx>TH){ mainIndex=(mainIndex-1+mainSlides.length)%mainSlides.length; updateMainCarousel(mainIndex); }
      } else {
        if(dy<-TH){ subIndex[mainIndex]=Math.min(subIndex[mainIndex]+1,3); updateSubstack(mainIndex);}
        else if(dy>TH){ subIndex[mainIndex]=Math.max(subIndex[mainIndex]-1,0); updateSubstack(mainIndex);}
      }
    }, {passive:true});

    // Marker hit
    marker.addEventListener('targetFound', ()=>{
      markerVisible=true;
      dotsContainer.style.opacity=1;
      animateOnce(carousel, 'animation__up', {
        property:'position', from:'-0.1 -0.2 0', to:'-0.1 0.2 0', dur:400, easing:'easeOutCubic'
      });
    });

    // Marker hit
    marker.addEventListener('targetLost', ()=>{
      markerVisible=false;
      dotsContainer.style.opacity=0;
      animateOnce(carousel, 'animation__down', {
        property:'position', from:carousel.getAttribute('position'), to:'-0.1 -0.2 0', dur:400, easing:'easeInCubic'
      });
    });

    // Smooth follow behavior
    const targetPos = new THREE.Vector3();
    const targetQuat = new THREE.Quaternion();
    carousel.sceneEl.addEventListener('renderstart', () => {
      carousel.sceneEl.renderer.setAnimationLoop(() => {
        if(marker.object3D.visible){
          marker.object3D.getWorldPosition(targetPos);
          marker.object3D.getWorldQuaternion(targetQuat);
          carousel.object3D.position.lerp(targetPos, 0.25);
          carousel.object3D.quaternion.slerp(targetQuat, 0.25);
        }
      });
    });
  </script>
</body>
</html>
