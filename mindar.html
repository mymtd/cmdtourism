<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Telusuri Wisata Cimande AR</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>

  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      background: transparent;
      overflow: hidden;
      touch-action: manipulation;
    }
    a-scene {
      position: fixed; inset: 0; width: 100%; height: 100%;
      z-index: 0;
    }
    .a-enter-vr-button {
      display: none !important;
    }
    .back-button {
      position: absolute;
      top: 18px;
      left: 16px;
      z-index: 30;
      background: transparent;
      color: white;
      border: 0;
      padding: 8px 12px;
      text-decoration: none;
      font-size: 30px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto;
    }
    .slide-dots {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 20;
      display: flex;
      gap: 10px;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    .dot {
      width: 12px; height: 12px;
      border-radius: 50%;
      background: gray;
      opacity: 0.6;
      transform-origin: center;
      transition: all 0.25s ease;
    }
    .dot.active {
      background: limegreen;
      transform: scale(1.3);
      opacity: 1;
    }
    #lostOverlay {
      position: absolute;
      inset: 0;
      top: 130px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 25;
      opacity: 0.9;
      pointer-events: auto;
      transition: opacity 0.4s ease;
    }
    #lostOverlay.hidden {
      opacity: 0;
      pointer-events: none;
    }
    #lostOverlay img {
      aspect-ratio: 1/1;
      width: 72vw;
      height: auto;
      max-width: 100%;
      object-fit: cover;
      border-radius: 8px;
      opacity: 1;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      animation: pulse 3s ease-in-out infinite;
    }
    @media (orientation: landscape) {
      #lostOverlay img {
        width: auto;
        height: 72vh;
      }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.7; }
    }
    #lostOverlay .info {
      text-align: center;
      margin-top: 40px;
      color: white;
      font-family: system-ui, sans-serif;
      font-size: 14px;
      opacity: 0.9;
      transform: translateY(0);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }
    #lostOverlay .info a {
      color: white;
      font-style: italic;
      text-decoration: unset;
    }
  </style>
</head>


<body>
  <a href="index.html" class="back-button">‚Üê</a>

  <div class="slide-dots" id="slideDots">
    <div class="dot active"></div>
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>
  </div>

  <div id="lostOverlay">
    <img src="./assets/coverscan.jpg" alt="Peta Wisata Cimande">
    <div class="info">
      <p></br>Arahkan kamera ke peta</br>untuk telusuri Wisata Cimande</p>
      <a href="https://desawisatacimande.com" target="_blank">Download & print peta</a>
    </div>
  </div>

  <a-scene
    mindar-image="imageTargetSrc: ./assets/marker.mind;
                  autoStart: true;
                  maxTrack: 1;
                  filterMinCF: 0.001;
                  filterBeta: 0.05;"
    embedded
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    renderer="colorManagement: false; physicallyCorrectLights: false; antialias: false;"
  >
    <a-entity light="type: ambient; intensity: 1"></a-entity>
    <!--a-entity light="type: directional; intensity: 1; position: 1 2 1"></a-entity-->

    <a-assets>
      <img id="img-a0" src="./assets/coverpeta.jpg">
      <img id="img-a1" src="./assets/img-pencak1.jpg">
      <img id="img-a2" src="./assets/img-pencak2.jpg">
      <img id="img-a3" src="./assets/img-pencak3.jpg">
      <img id="img-a4" src="./assets/img-pencak4.jpg">
      <img id="img-b1" src="./assets/img-salak5.jpg">
      <img id="img-b2" src="./assets/img-salak2.jpg">
      <img id="img-b3" src="./assets/img-salak3.jpg">
      <img id="img-b4" src="./assets/img-salak1.jpg">
      <img id="img-c1" src="./assets/img-lidah3.jpg">
      <img id="img-c2" src="./assets/img-lidah1.jpg">
      <img id="img-c3" src="./assets/img-lidah4.jpg">
      <img id="img-c4" src="./assets/img-lidah5.jpg">
      <img id="img-d1" src="./assets/img-alam5.jpg">
      <img id="img-d2" src="./assets/img-alam1.jpg">
      <img id="img-d3" src="./assets/img-alam2.jpg">
      <img id="img-d4" src="./assets/img-alam3.jpg">

      <a-asset-item id="3d-silat" src="./assets/3d-silat.glb"></a-asset-item>
      <a-asset-item id="3d-kujang" src="./assets/3d-kujang.glb"></a-asset-item>
      <a-asset-item id="3d-salak" src="./assets/3d-salak.glb"></a-asset-item>
      <a-asset-item id="3d-lidah" src="./assets/3d-lidah.glb"></a-asset-item>
      <a-asset-item id="3d-gunung" src="./assets/3d-gunung.glb"></a-asset-item>
      <a-asset-item id="3d-bunga1" src="./assets/3d-bunga1.glb"></a-asset-item>
      <a-asset-item id="3d-bunga2" src="./assets/3d-bunga2.glb"></a-asset-item>
      <a-asset-item id="3d-tanam1" src="./assets/3d-tanam1.glb"></a-asset-item>
      <a-asset-item id="3d-tanam2" src="./assets/3d-tanam2.glb"></a-asset-item>
      <a-asset-item id="3d-tanam3" src="./assets/3d-tanam3.glb"></a-asset-item>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false" fov="150"></a-camera>

    <a-entity id="marker" mindar-image-target="targetIndex: 0; autoHide: false;">
      <a-plane id="bgPlane" width="12" height="10" position="0 0 -0.1" material="color: black; opacity: 0; transparent: true;"></a-plane>
      <a-entity id="carousel" position="0 0 0" scale="1 1 1">
        <a-entity class="main-slide" position="0 0 0">
          <a-gltf-model src="#3d-bunga2" position="0 -0.48 0.05" scale="0.18 0.18 0.18" rotation="0 90 90" visible="true"
          animation="property: rotation; to: 360 90 90; loop: true; dur: 10000; easing: linear"></a-gltf-model>
          <a-gltf-model src="#3d-bunga1" position="0.25 -0.48 0.05" scale="0.1 0.03 0.1" rotation="0 90 90" visible="true"
          animation="property: rotation; to: 360 90 90; loop: true; dur: 12000; easing: linear"></a-gltf-model>
          <a-gltf-model src="#3d-bunga1" position="-0.25 -0.48 0.05" scale="0.1 0.03 0.1" rotation="0 90 90" visible="true"
          animation="property: rotation; to: -360 90 90; loop: true; dur: 15000; easing: linear"></a-gltf-model>
          <a-plane src="#img-a0" width="1.1" height="0.88" material="shader: flat"></a-plane>
          <a-text value="Slide untuk telusuri obyek Wisata Cimande"
          align="center" width="1.2" scale="0.8 0.8 0.8" position="0 -0.85 0.05" color="#fff"></a-text>
        </a-entity>
        <a-entity class="main-slide" position="1.3 0 0">
          <a-gltf-model src="#3d-kujang" position="-0.3 0.41 0.1" scale="0.18 0.18 0.18" rotation="90 90 0" visible="true"></a-gltf-model>
          <a-gltf-model src="#3d-bunga2" position="-0.4 0.41 0.05" scale="0.15 0.05 0.15" rotation="0 90 90" visible="true"
          animation="property: rotation; to: 360 90 90; loop: true; dur: 30000; easing: linear"></a-gltf-model>
          <a-entity class="substack" position="0 0 0">
            <a-entity class="sub" position="0 0.6 0">
              <a-plane src="#img-a1" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Pencak Silat Cimande tidak hanya dipelajari untuk tujuan pertahanan diri, tetapi juga untuk melestarikan warisan leluhur yang mencerminkan kebijaksanaan masyarakat Sunda."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 0 0">
              <a-plane src="#img-a2" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Lahir dari kearifan lokal masyarakat pada abad ke-18, Pencak Silat Cimande menjadi warisan budaya yang berpengaruh besar terhadap perkembangan pencak silat di Indonesia."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -0.6 0">
              <a-plane src="#img-a3" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Ciri khas aliran ini terletak pada keanggunan gerak dalam menghadapi serangan, di mana setiap jurus mencerminkan keseimbangan antara kekuatan fisik dan ketenangan batin."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -1.2 0">
              <a-plane src="#img-a4" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Lebih dari sekadar olahraga, Cimande menjadi sarana pembentukan karakter yang mengajarkan pentingnya menghormati guru, menjaga diri, serta menjalin harmoni dengan sesama."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
          </a-entity>
        </a-entity>
        <a-entity class="main-slide" position="1.3 0 0">
          <a-gltf-model src="#3d-salak" position="0 0.34 0.15" scale="0.12 0.12 0.12" rotation="0 0 0" visible="true"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 5000; easing: linear"></a-gltf-model>
          <a-gltf-model src="#3d-bunga1" position="0 0.38 0.05" scale="0.2 0.05 0.2" rotation="0 90 90" visible="true"
          animation="property: rotation; to: 360 90 90; loop: true; dur: 40000; easing: linear"></a-gltf-model>
          <a-entity class="substack" position="0 0 0">
            <a-entity class="sub" position="0 0.6 0">
              <a-plane src="#img-b1" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Kebun salak ini menjadi destinasi ideal bagi keluarga maupun pelajar yang ingin berwisata alam sekaligus menambah pengetahuan pertanian tradisional."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 0 0">
              <a-plane src="#img-b2" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Perkebunan salak Slebor di Desa Cimande menawarkan pengalaman agro wisata yang memadukan keindahan alam dengan aktivitas pertanian yang edukatif."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -0.6 0">
              <a-plane src="#img-b3" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Terletak di tengah hamparan persawahan yang asri, wisatawan dapat berjalan di antara deretan pohon salak Slebor yang tumbuh subur."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -1.2 0">
              <a-plane src="#img-b4" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Varietas salak Slebor terkenal dengan rasa manis dan teksturnya yang renyah, menjadikannya ikon pertanian khas Cimande yang banyak digemari wisatawan."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
          </a-entity>
        </a-entity>
        <a-entity class="main-slide" position="2.6 0 0">
          <a-gltf-model src="#3d-lidah" position="-0.33 -0.38 0.15" scale="0.12 0.12 0.12" rotation="0 0 0" visible="true"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"></a-gltf-model>
          <a-gltf-model src="#3d-tanam1" position="-0.5 -0.4 0.05" scale="0.2 0.25 0.2" rotation="0 0 0" visible="true"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 40000; easing: linear"></a-gltf-model>
          <a-entity class="substack" position="0 0 0">
            <a-entity class="sub" position="0 0.6 0">
              <a-plane src="#img-c1" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Melalui kegiatan ini, Desa Cimande menunjukkan komitmennya dalam mengembangkan potensi lokal tanpa meninggalkan kearifan tradisional yang menjadi ciri khasnya."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 0 0">
              <a-plane src="#img-c2" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-gltf-model src="#3d-lidah" position="0 0.1 0.2" scale="0.2 0.2 0.2" rotation="0 0 0" visible="false"
              animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"></a-gltf-model>
              <a-text value="Desa Cimande menghadirkan agro wisata pengolahan tanaman lidah buaya yang memadukan unsur pertanian dan kreativitas masyarakat lokal."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -0.6 0">
              <a-plane src="#img-c3" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Wisatawan dapat melihat proses budidaya hingga pengolahan lidah buaya menjadi berbagai produk bernilai tambah, seperti minuman segar hingga bahan obat tradisional."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -1.2 0">
              <a-plane src="#img-c4" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Kegiatan ini tidak hanya memperkenalkan potensi pertanian desa, tetapi juga mengajarkan pentingnya inovasi dan pemanfaatan hasil alam secara berkelanjutan."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
          </a-entity>
        </a-entity>
        <a-entity class="main-slide" position="3.9 0 0">
          <a-gltf-model src="#3d-gunung" position="0 0.4 0" scale="0.12 0.08 0.12" rotation="0 0 0" visible="true"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 15000; easing: linear"></a-gltf-model>
          <a-gltf-model src="#3d-tanam2" position="-0.5 -0.4 0.05" scale="0.2 0.25 0.2" rotation="0 0 0" visible="true"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 20000; easing: linear"></a-gltf-model>
          <a-gltf-model src="#3d-tanam3" position="0.5 -0.4 0.05" scale="0.2 0.25 0.2" rotation="0 0 0" visible="true"
          animation="property: rotation; to: 0 -360 0; loop: true; dur: 20000; easing: linear"></a-gltf-model>
          <a-entity class="substack" position="0 0 0">
            <a-entity class="sub" position="0 0.6 0">
              <a-plane src="#img-d1" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Dengan keindahan alamnya yang autentik dan suasananya yang damai, jelajah alam di kawasan Cimande ideal untuk mencari keseimbangan antara petualangan dan relaksasi."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 0 0">
              <a-plane src="#img-d2" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-gltf-model src="#3d-gunung" position="0 0.1 0.2" scale="0.2 0.2 0.2" rotation="0 0 0" visible="false"
              animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"></a-gltf-model>
              <a-text value="Desa Cimande memiliki pesona alam pegunungan yang menawan sekaligus memberikan ruang bagi wisatawan untuk menikmati ketenangan jauh dari hiruk pikuk perkotaan."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -0.6 0">
              <a-plane src="#img-d3" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Terletak di kaki Gunung Salak dan Gede Pangrango, kawasan ini menawarkan jalur trekking dengan pemandangan hamparan perkebunan dan pepohonan rindang."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
            <a-entity class="sub" position="0 -1.2 0">
              <a-plane src="#img-d4" width="0.9" height="0.72" material="shader: flat"></a-plane>
              <a-text value="Aktivitas ini bukan sekadar olahraga, melainkan juga bentuk refleksi diri untuk menghargai keseimbangan antara manusia dan lingkungan."
              align="center" width="1" scale="0.7 0.7 0.7" position="0 -0.44 0.05" color="#fff"></a-text>
            </a-entity>
          </a-entity>
        </a-entity>
      </a-entity>
    </a-entity>
  </a-scene>


  <script>
    const marker = document.querySelector('#marker');
    const carousel = document.querySelector('#carousel');
    const bgPlane = document.querySelector('#bgPlane');
    const mainSlides = Array.from(document.querySelectorAll('.main-slide'));
    const dots = Array.from(document.querySelectorAll('.dot'));
    const dotsContainer = document.querySelector('#slideDots');
    const lostOverlay = document.querySelector('#lostOverlay');
    
    let markerVisible = false;
    let startX = 0;
    let startY = 0;
    let mainIndex = 0;
    const subIndex = [0,1,1,1,1];
    const animDur = 280;
    const mainSpacing = 1.2;
    const subSpacing = 0.9;

    let isActive = false;
    let lastRender = 0;
    const fpsLimit = 30;

    // Animation helper
    function animateOnce(el, name, data) {
      el.removeAttribute(name);
      void el.offsetWidth;
      el.setAttribute(name, data);
    }

    // Main slides
    function updateMainCarousel(newIdx){
      mainSlides.forEach((ms, i)=>{
        const x = (i - newIdx) * mainSpacing;
        animateOnce(ms, 'animation__pos', {
          property:'position', to:`${x} 0 0`, dur:animDur, easing:'easeOutCubic'
        });
      });
      dots.forEach((d,i)=>d.classList.toggle('active', i===newIdx));
    }

    // Sub slides
    function updateSubstack(mainIdx){
      const subs = mainSlides[mainIdx].querySelectorAll('.sub');
      const active = subIndex[mainIdx];
      subs.forEach((sub, i) => {
        const y = (i - active) * subSpacing;
        const text = sub.querySelector('a-text');
        animateOnce(sub, 'animation__sub', {
          property: 'position',
          to: `0 ${-y} 0`,
          dur: animDur,
          easing: 'easeOutCubic'
        });
        const scale = (i === active) ? '1.1 1.1 1.1' : '0.7 0.7 0.7';
        animateOnce(sub, 'animation__scale', {
          property: 'scale',
          to: scale,
          dur: animDur,
          easing: 'easeOutCubic'
        });
        const plane = sub.querySelector('a-plane');
        if (i === active) {
          plane.setAttribute('material', 'opacity', 1);
          text.setAttribute('visible', true);
        } else {
          plane.setAttribute('material', 'opacity', 0.5);
          text.setAttribute('visible', false);
        }
      });
    }
    mainSlides.forEach((_,i)=>updateSubstack(i));
    updateMainCarousel(mainIndex);

    // Swipe behaviour
    document.body.addEventListener('touchstart', e=>{
      if(!markerVisible) return;
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    }, {passive:true});
    document.body.addEventListener('touchend', e=>{
      if(!markerVisible) return;
      const endX=e.changedTouches[0].clientX;
      const endY=e.changedTouches[0].clientY;
      const dx=endX-startX, dy=endY-startY;
      const TH=40;
      if(Math.abs(dx)>Math.abs(dy)){
        if(dx<-TH){ mainIndex=(mainIndex+1)%mainSlides.length; updateMainCarousel(mainIndex); }
        else if(dx>TH){ mainIndex=(mainIndex-1+mainSlides.length)%mainSlides.length; updateMainCarousel(mainIndex); }
      } else {
        if(dy<-TH && mainIndex>0){ subIndex[mainIndex]=Math.min(subIndex[mainIndex]+1,3); updateSubstack(mainIndex);}
        else if(dy>TH && mainIndex>0){ subIndex[mainIndex]=Math.max(subIndex[mainIndex]-1,0); updateSubstack(mainIndex);}
      }
    }, {passive:true});

    // Marker hit
    marker.addEventListener('targetFound', ()=>{
      isActive = true;
      markerVisible = true;
      dotsContainer.style.opacity = 1;
      lostOverlay.classList.add('hidden');
      animateOnce(bgPlane, 'animation__fadein', {
        property: 'material.opacity', from: 0, to: 0.85, dur: 400, easing: 'easeOutCubic'
      });
      animateOnce(carousel, 'animation__up', {
        property:'position', from:'0 -0.4 0', to:'0 0 0', dur:400, easing:'easeOutCubic'
      });
    });

    // Maker lost
    marker.addEventListener('targetLost', ()=>{
      isActive = false;
      markerVisible = false;
      dotsContainer.style.opacity = 0;
      lostOverlay.classList.remove('hidden');
      animateOnce(bgPlane, 'animation__fadeout', {
        property: 'material.opacity', from: bgPlane.getAttribute('material').opacity, to: 0, dur: 400, easing: 'easeInCubic'
      });
      animateOnce(carousel, 'animation__down', {
        property:'position', from:carousel.getAttribute('position'), to:'0 0.4 0', dur:400, easing:'easeInCubic'
      });
    });

    // Optimizer
    AFRAME.registerComponent("render-optimizer", {
      tick: function (time, delta) {
        if (!isActive) return;
      }
    });
    AFRAME.registerComponent("fps-throttle", {
      tick: function (time) {
        if (time - lastRender < 1000 / fpsLimit) return;
        lastRender = time;
      }
    });
  </script>
</body>
</html>
