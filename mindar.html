<html>
  <head>
    <meta charset="UTF-8" />
    <title>Explore Cimande with AR</title>

    <!-- A-Frame + MindAR -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
      body, html { margin: 0; padding: 0; overflow: hidden; }
      .dot-container {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 4px;
        visibility: hidden;
      }
      .dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: white;
        opacity: 0.4;
        transition: transform 0.2s ease;
      }
      .dot.active {
        opacity: 1;
        background: yellow;
        transform: scale(1.3);
      }
    </style>
  </head>
  
  <body>
    <a-scene
      mindar-image="imageTargetSrc: ./assets/marker.mind;
                    autoStart: true;
                    filterMinCF: 0.001;
                    filterBeta: 0.05;"
      embedded
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true"
      renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true;"
      shadow="type: pcfsoft">
      
      <!-- Lighting for soft shadows -->
      <a-entity light="type: ambient; intensity: 0.8;"></a-entity>
      <a-entity light="type: directional; intensity: 0.6; position: 1 2 1" castShadow="true"></a-entity>

      <!-- Assets -->
      <a-assets>
        <img id="img1" src="./assets/img-pencak3.jpg">
        <img id="img2" src="./assets/img-pencak4.jpg">
        <img id="img3" src="./assets/img-salak3.jpg">
        <img id="img4" src="./assets/img-lidah3.jpg">
        <img id="img5" src="./assets/img-alam4.jpg">
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false" fov="150" ></a-camera>

      <!-- Marker root -->
      <a-entity id="marker" mindar-image-target="targetIndex: 0">
        <a-entity id="carousel" position="0 0 0">

          <!-- Slide 1 -->
          <a-entity class="slide" position="0 0 0">
            <a-text class="title" value="Title 1" align="center" width="2" position="0 0.6 0"></a-text>
            <a-plane src="#img1" position="0 0 0.1" shadow="receive: true"></a-plane>
            <a-text class="desc" value="Description for image 1" align="center" width="2" position="0 -0.6 0"></a-text>
          </a-entity>

          <!-- Slide 2 -->
          <a-entity class="slide" position="1 0 0">
            <a-text class="title" value="Title 2" align="center" width="2" position="0 0.6 0"></a-text>
            <a-plane src="#img2" position="0 0 0.1" shadow="receive: true"></a-plane>
            <a-text class="desc" value="Description for image 2" align="center" width="2" position="0 -0.6 0"></a-text>
          </a-entity>

          <!-- Slide 3 -->
          <a-entity class="slide" position="2 0 0">
            <a-text class="title" value="Title 3" align="center" width="2" position="0 0.6 0"></a-text>
            <a-plane src="#img3" position="0 0 0.1" shadow="receive: true"></a-plane>
            <a-text class="desc" value="Description for image 3" align="center" width="2" position="0 -0.6 0"></a-text>
          </a-entity>

          <!-- Slide 4 -->
          <a-entity class="slide" position="3 0 0">
            <a-text class="title" value="Title 4" align="center" width="2" position="0 0.6 0"></a-text>
            <a-plane src="#img4" position="0 0 0.1" shadow="receive: true"></a-plane>
            <a-text class="desc" value="Description for image 4" align="center" width="2" position="0 -0.6 0"></a-text>
          </a-entity>

          <!-- Slide 5 -->
          <a-entity class="slide" position="4 0 0">
            <a-text class="title" value="Title 5" align="center" width="2" position="0 0.6 0"></a-text>
            <a-plane src="#img5" position="0 0 0.1" shadow="receive: true"></a-plane>
            <a-text class="desc" value="Description for image 5" align="center" width="2" position="0 -0.6 0"></a-text>
          </a-entity>

        </a-entity>
      </a-entity>
    </a-scene>

    <!-- Dots -->
    <div class="dot-container" id="dots">
      <div class="dot active"></div>
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>

    <script>
      const carousel = document.querySelector("#carousel");
      const slides = document.querySelectorAll(".slide");
      const dots = document.querySelectorAll(".dot");
      const dotsContainer = document.querySelector("#dots");

      let currentIndex = 0;
      const spacing = 1.1; 
      const speed = 250;

      function updateCarousel(index) {
        slides.forEach((slide, i) => {
          let offset = (i - index) * spacing;
          slide.setAttribute("animation__move", {
            property: "position",
            to: `${offset} 0 0`,
            dur: speed,
            easing: "easeOutCubic"
          });

          const title = slide.querySelector(".title");
          const desc = slide.querySelector(".desc");
          const visible = (i === index);
          title.setAttribute("visible", visible);
          desc.setAttribute("visible", visible);
        });

        dots.forEach((d,i)=> d.classList.toggle("active", i===index));
      }

      // Swipe gestures
      let startX = 0;
      document.body.addEventListener("touchstart", (e)=>{
        startX = e.touches[0].clientX;
      });
      document.body.addEventListener("touchend", (e)=>{
        let endX = e.changedTouches[0].clientX;
        if (endX < startX - 50) {
          currentIndex = (currentIndex + 1) % slides.length;
          updateCarousel(currentIndex);
        }
        if (endX > startX + 50) {
          currentIndex = (currentIndex - 1 + slides.length) % slides.length;
          updateCarousel(currentIndex);
        }
      });

      updateCarousel(currentIndex);

      // Show/hide dots
      const marker = document.querySelector("#marker");
      marker.addEventListener("targetFound", () => {
        dotsContainer.style.visibility = "visible";
      });
      marker.addEventListener("targetLost", () => {
        dotsContainer.style.visibility = "hidden";
      });

      // Smooth follow
      const targetPos = new THREE.Vector3();
      const targetQuat = new THREE.Quaternion();
      carousel.sceneEl.addEventListener("renderstart", () => {
        carousel.sceneEl.renderer.setAnimationLoop(() => {
          if (marker.object3D.visible) {
            marker.object3D.getWorldPosition(targetPos);
            marker.object3D.getWorldQuaternion(targetQuat);
            carousel.object3D.position.lerp(targetPos, 0.15);
            carousel.object3D.quaternion.slerp(targetQuat, 0.15);
          }
        });
      });

      // Auto image aspect ratio (prevent stretching)
      document.addEventListener("DOMContentLoaded", () => {
        const planes = document.querySelectorAll("a-plane");
        planes.forEach(plane => {
          const img = document.querySelector(plane.getAttribute("src"));
          if (img.complete) adjustAspect(plane, img);
          else img.addEventListener("load", () => adjustAspect(plane, img));
        });

        function adjustAspect(plane, img) {
          const ratio = img.naturalWidth / img.naturalHeight;
          const height = 0.8;
          const width = height * ratio;
          plane.setAttribute("width", width);
          plane.setAttribute("height", height);
        }
      });
    </script>
  </body>
</html>
