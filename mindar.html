<html>
  <head>
    <meta charset="UTF-8" />
    <title>Telusuri Cimande AR</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
      body, html { margin: 0; padding: 0; overflow: hidden; }
      .dot-container {
        position: absolute;
        bottom: 50px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 4px;
        visibility: hidden;
      }
      .dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: white;
        opacity: 0.4;
        transition: transform 0.2s ease;
      }
      .dot.active {
        opacity: 1;
        background: limegreen;
        transform: scale(1.3);
      }
      .back-button {
        position: absolute;
        top: 20px;
        left: 20px;
        background: transparent;
        color: white;
        border: 1px solid white;
        padding: 8px 14px;
        border-radius: 6px;
        font-family: sans-serif;
        text-decoration: none;
        z-index: 10;
        opacity: 0.8;
      }
    </style>
  </head>
  
  
  <body>
    <a href="index.html" class="back-button">‚Üê</a>
    <a-scene
      mindar-image="imageTargetSrc: ./assets/marker.mind;
                    autoStart: true;
                    filterMinCF: 0.001;
                    filterBeta: 0.05;"
      embedded
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true"
      renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true;"
      shadow="type: pcfsoft">
      
      <a-entity light="type: ambient; intensity: 1.5;"></a-entity>
      <a-entity light="type: directional; intensity: 1.5; position: 1 2 1" castShadow="true"></a-entity>

      <a-assets>
        <img id="img1" src="./assets/img-pencak3.jpg">
        <img id="img2" src="./assets/img-pencak4.jpg">
        <img id="img3" src="./assets/img-salak3.jpg">
        <img id="img4" src="./assets/img-lidah3.jpg">
        <img id="img5" src="./assets/img-alam4.jpg">
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false" fov="150"></a-camera>

      <a-entity id="marker" mindar-image-target="targetIndex: 0; autoHide: false;">
        <a-plane id="overlayPlane"
                 position="0 0 0.01"
                 width="10"
                 height="10"
                 material="color: black; opacity: 0; transparent: true;"
                 visible="true">
        </a-plane>
        <a-entity id="carousel" position="0 0 0">
          <a-entity class="slide" position="0 0 0">
            <a-text class="title" value="" align="center" width="2" position="0 0.5 0"></a-text>
            <a-plane src="#img1" width="1" height="0.8" position="0 0 0.05" material="shader: flat;"></a-plane>
            <a-text class="desc" value="Description for image 1"
            align="center" width="1.3" position="0 -0.5 0.1" scale="0.8 0.8 0.8"></a-text>
          </a-entity>
          <a-entity class="slide" position="1 0 0">
            <a-text class="title" value="" align="center" width="2" position="0 0.5 0"></a-text>
            <a-plane src="#img2" width="1" height="0.8" position="0 0 0.05" material="shader: flat;"></a-plane>
            <a-text class="desc" value="Description for image 2"
            align="center" width="1.3" position="0 -0.5 0.1" scale="0.8 0.8 0.8"></a-text>
          </a-entity>
          <a-entity class="slide" position="2 0 0">
            <a-text class="title" value="" align="center" width="2" position="0 0.5 0"></a-text>
            <a-plane src="#img3" width="1" height="0.8" position="0 0 0.05" material="shader: flat;"></a-plane>
            <a-text class="desc" value="Description for image 3"
            align="center" width="1.3" position="0 -0.5 0.1" scale="0.8 0.8 0.8"></a-text>
          </a-entity>
          <a-entity class="slide" position="3 0 0">
            <a-text class="title" value="" align="center" width="2" position="0 0.5 0"></a-text>
            <a-plane src="#img4" width="1" height="0.8" position="0 0 0.05" material="shader: flat;"></a-plane>
            <a-text class="desc" value="Description for image 4"
            align="center" width="1.3" position="0 -0.5 0.1" scale="0.8 0.8 0.8"></a-text>
          </a-entity>
          <a-entity class="slide" position="4 0 0">
            <a-text class="title" value="" align="center" width="2" position="0 0.5 0"></a-text>
            <a-plane src="#img5" width="1" height="0.8" position="0 0 0.05" material="shader: flat;"></a-plane>
            <a-text class="desc" value="Description for image 5"
            align="center" width="1.3" position="0 -0.5 0.1" scale="0.8 0.8 0.8"></a-text>
          </a-entity>
        </a-entity>
      </a-entity>
    </a-scene>

    <div class="dot-container" id="dots">
      <div class="dot active"></div>
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>


    <script>
      const carousel = document.querySelector("#carousel");
      const slides = document.querySelectorAll(".slide");
      const dots = document.querySelectorAll(".dot");
      const dotsContainer = document.querySelector("#dots");
      const overlayPlane = document.querySelector("#overlayPlane");
      const marker = document.querySelector("#marker");
      let currentIndex = 0;
      const spacing = 1.1; 
      const speed = 250;

      //Carousel slides
      function updateCarousel(index) {
        slides.forEach((slide, i) => {
          let offset = (i - index) * spacing;
          slide.setAttribute("animation__move", {
            property: "position",
            to: `${offset} 0 0`,
            dur: speed,
            easing: "easeOutCubic"
          });
          const title = slide.querySelector(".title");
          const desc = slide.querySelector(".desc");
          const visible = (i === index);
          title.setAttribute("visible", visible);
          desc.setAttribute("visible", visible);
        });
        dots.forEach((d,i)=> d.classList.toggle("active", i===index));
      }

      //Animation helper
      function animateOnce(el, name, property, data) {
        el.removeAttribute(name);
        el.setAttribute(name, data);
      }

      // Swipe gestures
      let startX = 0;
      document.body.addEventListener("touchstart", (e)=>{
        startX = e.touches[0].clientX;
      });
      document.body.addEventListener("touchend", (e)=>{
        let endX = e.changedTouches[0].clientX;
        if (endX < startX - 50) {
          currentIndex = (currentIndex + 1) % slides.length;
          updateCarousel(currentIndex);
        }
        if (endX > startX + 50) {
          currentIndex = (currentIndex - 1 + slides.length) % slides.length;
          updateCarousel(currentIndex);
        }
      });

      updateCarousel(currentIndex);

      //Marker hit
      marker.addEventListener("targetFound", () => {
        marker.setAttribute("visible", true);
        dotsContainer.style.visibility = "visible";

        animateOnce(overlayPlane, "animation__fadein", "material.opacity", {
          property: "material.opacity",
          to: 0.5,
          dur: 400,
          easing: "easeInOutQuad"
        });

        animateOnce(carousel, "animation__slideup", "position", {
          property: "position",
          from: "0 -0.5 0",
          to: "0 0 0",
          dur: 400,
          easing: "easeOutCubic"
        });
      });

      //Marker lost
      marker.addEventListener("targetLost", () => {
        dotsContainer.style.visibility = "hidden";

        animateOnce(overlayPlane, "animation__fadeout", "material.opacity", {
          property: "material.opacity",
          to: 0,
          dur: 400,
          easing: "easeInOutQuad"
        });

        animateOnce(carousel, "animation__slidedown", "position", {
          property: "position",
          from: carousel.getAttribute("position"),
          to: "0 -0.5 0",
          dur: 400,
          easing: "easeInCubic"
        });

        setTimeout(() => {
          marker.setAttribute("visible", false);
        }, 400);
      });

      // Smooth follow
      const targetPos = new THREE.Vector3();
      const targetQuat = new THREE.Quaternion();
      carousel.sceneEl.addEventListener("renderstart", () => {
        carousel.sceneEl.renderer.setAnimationLoop(() => {
          if (marker.object3D.visible) {
            marker.object3D.getWorldPosition(targetPos);
            marker.object3D.getWorldQuaternion(targetQuat);
            carousel.object3D.position.lerp(targetPos, 0.15);
            carousel.object3D.quaternion.slerp(targetQuat, 0.15);
          }
        });
      });
    </script>
  </body>
</html>
